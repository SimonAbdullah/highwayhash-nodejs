const { resetKey, hash64, hash128, hash256 } = require("./index.js");

const key = "07060504030201000F0E0D0C0B0A090817161514131211101F1E1D1C1B1A1918";
resetKey(Buffer.from(key, "hex"));

const maxSize = 64;
const data = Buffer.alloc(maxSize);
for (let size = 0; size < maxSize; size++) {
  data[size] = Buffer.from([size])[0];
}

const expected64HexHashes = [
  "907a56de22c26e53",
  "7eab43aac7cddd78",
  "b8d0569ab0b53d62",
  "5c6befab8a463d80",
  "f205a46893007eda",
  "2b8a1668e4a94541",
  "bd4ccc325befca6f",
  "4d02ae1738f59482",
  "e1205108e55f3171",
  "32d2644ec77a1584",
  "f6e10acdb103a90b",
  "c3bbf4615b415c15",
  "243cc2040063fa9c",
  "a89a58ce65e641ff",
  "24b031a348455a23",
  "40793f86a449f33b",
  "cfab3489f97eb832",
  "19fe67d2c8c5c0e2",
  "04dd90a69c565cc2",
  "75d9518e2371c504",
  "38ad9b1141d3dd16",
  "0264432ccd8a70e0",
  "a9db5a6288683390",
  "d7b05492003f028c",
  "205f615aea59e51e",
  "eee0c89621052884",
  "1bfc1a93a7284f4f",
  "512175b5b70da91d",
  "f71f8976a0a2c639",
  "ae093fef1f84e3e7",
  "22ca92b01161860f",
  "9fc7007ccf035a68",
  "a0c964d9ecd580fc",
  "2c90f73ca03181fc",
  "185cf84e5691eb9e",
  "4fc1f5ef2752aa9b",
  "f5b7391a5e0a33eb",
  "b9b84b83b4e96c9c",
  "5e42fe712a5cd9b4",
  "a150f2f90c3f97dc",
  "7fa522d75e2d637d",
  "181ad0cc0dffd32b",
  "3889ed981e854028",
  "fb4297e8c586ee2d",
  "6d064a45bb28059c",
  "90563609b3ec860c",
  "7aa4fce94097c666",
  "1326bac06b911e08",
  "b926168d2b154f34",
  "9919848945b1948d",
  "a2a98fc534825ebe",
  "e9809095213ef0b6",
  "582e5483707bc0e9",
  "086e9414a88a6af5",
  "ee86b98d20f6743d",
  "f89b7ff609b1c0a7",
  "4c7d9cc19e22c3e8",
  "9a97005024562a6f",
  "5dd41cf423e6ebef",
  "df13609c0468e227",
  "6e0da4f64188155a",
  "b755ba4b50d7d4a1",
  "887a3484647479bd",
  "ab8eebe9bf2139a0",
  "75542c5d4cd2a6ff",
];

const expected128HexHashes = [
  "0fed268f9d8ffec733565e767f093e6f",
  "d6b0a8893681e7a8dc291df9eb9cdcb4",
  "3d15ad265a16da0478085638dc32e868",
  "0607621b295f0bebbfe69a0fd9cedd79",
  "26399eb46dace49e2e922ad039319208",
  "3250bdc386d12ed8193810906c63c23a",
  "6f476ab3cb8965477cde576f37ed1019",
  "2a401fca697171b4be1f03ff9f02796c",
  "a1e96d84280552e8695cf1c63bec0ac2",
  "142a2102f31e63b21a85b98c5b5000cc",
  "51a1b70e26b6bc5b929e1f3b2da45559",
  "88990362059a415bbed21f22c47b7d13",
  "cd1f1f5f1caf9566a818ba8ce0f9c8d4",
  "a225564112fe6157b2e94c78b8ddb848",
  "bd492febd1cc0919cecd1dbc025641a2",
  "142237a52bc4af54e0796c0b6e26bcd7",
  "414460ffd5a401ad029ea3d5019f18c8",
  "c52a4b96c51c9962ecb878b1169b5ea0",
  "d940ca8f11fbeacef93a46d616f8d531",
  "8ac49d0ae5c0cbf53ffdbf8df51d7c93",
  "ac6d279b852d00a87dcd3a6ba5ebaa46",
  "f11621bd93f08a563173c398163dd9d5",
  "0c4ce250f68cf89fb3123cda411898ed",
  "15ab97ed3d9a51ce7ce274479169080e",
  "cd001e198d4845b8d0d9d98bd8aa2d77",
  "34f3d617a0493d797dd304f6397f7e16",
  "5cb56890a9f4c6b6130829166567304f",
  "30da6f8b245bd1c06f828b7e3fd9748c",
  "e0580349204c12c093f6da0cac5f441c",
  "f648731ba50730455fb897114fb65976",
  "024f8354738a5206509a4918eb7e0991",
  "06e7b465e8a57c2952415e3a07f5d446",
  "1984df66c1434aaa16fc1958f9b3e4b9",
  "111678afe0c6c36cf958b59de5a2849d",
  "773fbc8440fb0490c96ed5d243658536",
  "91e3dc710bb6c941ea336a0bc1eeace9",
  "25cfe3815d7ad9d4f2e94f8c828fc59e",
  "b9fb38b83cc288f27479c4c8f850ec04",
  "1d85d5c525982b8c6e26b1c16f48dbf4",
  "8a4e55bd6060bde72134d599058b3fd0",
  "2a958ff994778f36e8052d1ae61d6423",
  "89233ae6be4532333acf9c87d7e8c0b9",
  "4458f5e27ea9c8d5418fb49bca2a5140",
  "090301837ed12a681017f69633c861e6",
  "330dd84704d49590339df1ad3a4ba6e4",
  "569363a663f2c576363b3d95e3c95ef6",
  "acc8d08586b907372ba0e8087d4e28e9",
  "39c27a27c86d95208db620a45160932e",
  "8e6a4aeb671a072d6ed3561a10e47ee6",
  "0011d765b1bec74ad80e6e656ede842e",
  "2515d62b936ac64cce088794d7088a7d",
  "91621552c16e23af264f0094eb23ccef",
  "1e21880d97263480d8654807d3a31086",
  "39d76aaf097f432da517e1e09d074739",
  "0f17a4f337c65a142f51215f69f976d4",
  "a0fb5cda12895e44568c3dc4d1f13cd1",
  "93c8fc00d89c46cebad5da947e330e69",
  "817c07501d1a5694584d6ee72cbfac2b",
  "91d668af73f053bff98e647683c1e0ed",
  "5281e1ef6b3ccf8bbc4cc3df166083d8",
  "aad61b6dbeaaeeb9ff969d000c16787b",
  "4325d84fc047587914b919bd905f1c2d",
  "79a176d1aa6ba6d1f1f720c5a53a2b86",
  "74bd7018022f3ef03aea94a8ad5f4bcb",
  "98bb1f7198d4c4f2e0bc0571de918fc8",
];

const expected256HexHashes = [
  "dd44482ac2c874f5d946017313c7351fb3aebeccb98714ff41da233145751df4",
  "edb941bce45f8254e20d44ef3dcac60f72651b9bcb324a472073624cb275e484",
  "3fdff9df24afe45411c4bf1a1b0ae873115169cc6922597a1208f6590d33b42c",
  "480aa0d70dd1d95c89225e7c6911d1d08ea8426b8bbb865ae23dfbc390e1c722",
  "c9cfc497212be4dca85f9df6afd2929b1fda9f211df4109e07e4277a374d4f9b",
  "b4b4f566a4dc85b3bf4b63ba5e46014215f48e68cddc1de30f74587d388085c6",
  "6445c70a86adb9b4a99cfb2784b4ceb6dae29d40a0b2db13b6526df29a9d1170",
  "d666b1a00987ad81a4f1f838eb8c6d37e9226e07d463e0305754d67d062c526c",
  "f1b905b0ed768bc0e6976ff3fcff3a454fbe518dd9d09778d9a0afeb371e0d33",
  "80d8e4d70d3c2981f10fbbd16424f1a1cf5c2dbe9d3f0cd1c0bfe8f701b673f2",
  "ade48c50e5a262be8e9492b1fdfe38e00784b74b2fe9b8380e41d574db656dcd",
  "a1be77b9531807cfba97a7de6a1a9738af274cef9c8e261f3e39b935c74ce8e8",
  "15ad3802e34058579d11cbdc39e853a023ea3e993c31b2256cd9e9e3caf4212e",
  "01c96f5eb1d77c36a367f9c1531f95a61f94a3427cdadcb897f1000abf3bd5d3",
  "0815e91eeeff8e410e0c28fa6e21df5d4ead8e62ed0953743ffd01da1c9d73e6",
  "c11905707842602e62c3db018501b14685f5ad17fa3406c1c884f87bd4fec347",
  "f51ad989a1b6cd1ff7f075d62a627bd97e01d5f579f28a061ad415c16a174d9f",
  "19f4cfa82ca4068e3b9d4abd3a9275b98000b0dde9c010c68884d50949215613",
  "126d6c7f81ab9f5d4edaa3c5097716eeaf121573a7dd3e499001ac85aa80c32d",
  "06aabef9149155fadf864f4144e71c3dfdbabce860bc64dade2ba54792491cb6",
  "adfc6b4035079fdba087b7328e486e6546d1a9935a4623eae3895c440d3cee44",
  "b5f9d31deea3b3df8f3024e20a06e133f24c38c8288fe120703f1dcf9bd69749",
  "2b3c0b854794efe31c5d3f969bdacea081f16aafa563ac2e23441c5a79d03075",
  "418af8c793fd3762bc6b8e9461d7f924776ff26a2a1a9e783aa0b7bfd417ca6e",
  "cd03ea2ad255a3c10185fee5b59c1b2ad1f438d44f9773e4be69dd67f83b76e4",
  "f951a8873887a0fb2c7b31d2a548e0ae44803838b6186efaa3c78ec7be219f72",
  "958ff151ea0d8c084b7e8997b4f63488c78e074351c5386dd95577556f20eefa",
  "29a917807fb054063318f884351f578cdd24ea6ef6f6a7fae74393465e97aeff",
  "98240880935e6ccb1fd0d271b09f97da56e786472700b183291649f99f747817",
  "1bd4954f7054c556ffdb2eff7c596ceb7c6ac69a1bab6b5b0f037670537fc153",
  "8825e38897597498647cf6ebaf6332c1552bd903dc28c91772d7632c00bfc5ab",
  "6880e276601a644db3728b20b10fb7dad0bd12060610d16e8aef14ef33452ef2",
  "bce38c9039a1c3fe42d56326a3c11289e35595f764fcaea9c9b03c6bc9475a99",
  "f60115cbf034a6e56c36ea75bfce46d03b17c8d3827259907edaa2ed11007a35",
  "1326e959edf9dea2c4776801739f720c5169500fd762f62f8a0dd0d90a2529ab",
  "935149d503d442d4ff6bb41302dad144339cb012cd9d36ece61d53619ecc2230",
  "528bc888aa50b696b8aeeca36084e1fca158151ec024347602c14aad097cec44",
  "bed688a72217c3271ee65114f760873f3f5c26b37d3002a6ddf2e895631597b9",
  "e7db21cf2b0b51adfafc6324f4b0ab6cb0857244c22d9c5bf0ad888d1e05849c",
  "05519793cd4dcb003c594a3163067debac75081acf119e345ac86297805cb094",
  "09228d8c22b5779e19644db2516b7e842b92c8abf83141a07f785ad725e19391",
  "59c42e5d46d0a74b5ea53c65ca03606448a9916bb635aeb4bae6df143f54e9d4",
  "5eb623696d03d0e3d53d78bcb41da092fe2348dc52f6b10d64802457632c8c11",
  "43b61bb2c4b85481c6318c25717e80a18c4a7f4d6f9c687dbd0217e035401d7c",
  "7f51ca5743824c37b04c4d5eb11d703a4d511e1ecbf6f369d66775ea215456e2",
  "39b409eef87e45cc52b8e8c459fc79b344920918d1858c2480f07b645eee0149",
  "ce8694d1be9ad514bfa19026526836e71ea4fdf6e4902a7d380c4458d696e1fe",
  "d189e18bf823a0a41f3b353be501a7d7a24f77b4e02e28847e94646f74f9180c",
  "aff8c635d325ec482c2e0aa414038d0b4ed37f611a44746739ec38e33b501489",
  "2a2bfdad5f83f197013d3e6ebef274cce1563c0477726155f15a8a5de932037e",
  "d5d1f91ec812633210110b9bf9b1ff11a175ab26541c603287badc5728701552",
  "c7b5a92cd8082884dda62ab61b2eeefb8f9882ecfeae732f6b38bd5cc01f4ffb",
  "cf6ef275733d32f0a3f0822da2bf7d8b304e7435f512406a0b28e3efebb3172d",
  "e698f80701b2e9db66ae2a819a8a882814ea9024c9b8f2c9a7416170523eb5a4",
  "3a917e87e307edb717b4dedae34452c1f689f162e711cc7029ce6bfe789cdd0e",
  "0eff3ad8cb155d8e47cd9ead4c0844a246c8e40ee6fe21ebdef3c25df0340a51",
  "03fd86e62b82d04d32ab0d600717136d682b0e832b857a89138ce3f1443739b1",
  "2f77c754c4d7f9021053e0a9d9adbfea58e66368544ae70ac48a829c72dd83ca",
  "f900eb19e466a09f31be9e01a8c7d3143afec6b8ca08f471b8c0eb0f87ffe7fb",
  "db277d8fbe3c8efb53ce6877e11aa57b719c94d20d9a7e7db345b56392453cc9",
  "37639c3bdba4f2c96095e7b336466dc83a8049791e65b88a82c988cde5927cd5",
  "6b1fb1a714234ae420562e255ba6467e3e2b892d40f3d675f40ce3fbe41ed768",
  "8ee11cb1b287c92a8fc2aaeff63d266d66643487e6eb9f03578aa91de8d56873",
  "f5b1f8266a3aeb6783b040be4dec1add7fe1c8635b26fbaef4a3a447defed79f",
  "90d8e6ff6ac124751a422a196edac1f29e3765fe1f8eb002c1bdd7c4c351cfbe",
];

let allPassed = true;
const testFunction = (hashFunc, expected) => {
  for (let index = 0; index < maxSize; index++) {
    const input = data.slice(0, index);
    try {
      const hashBuf = hashFunc(input);
      const isPassed = Buffer.from(hashBuf).equals(
        Buffer.from(expected[index], "hex")
      );
      if (isPassed) {
        console.log(`[PASSED] Hashing ${input.toString("hex")}`);
      } else {
        console.log(`[FAILED] Hashing ${input.toString("hex")}`);
        allPassed = false;
      }
    } catch (err) {
      console.log(`[FAILED] Hashing ${input.toString("hex")}`);
      allPassed = false;
    }
  }
};

console.log("\nTesting 64-bit hash:");
testFunction(hash64, expected64HexHashes);

console.log("\nTesting 128-bit hash:");
testFunction(hash128, expected128HexHashes);

console.log("\nTesting 256-bit hash:");
testFunction(hash256, expected256HexHashes);

console.log({ allPassed });

process.kill(process.pid);